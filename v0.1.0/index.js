"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Cell=function e(){_classCallCheck(this,e)};Cell.EMPTY=0,Cell.SNAKE=1,Cell.FRUIT=2;var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Grid=function(){function e(t){_classCallCheck(this,e),this.dimensions=t,this.init()}return _createClass(e,[{key:"init",value:function(){this.cells=[],this.initRows(),this.initCols()}},{key:"initRows",value:function(){for(var e=0;e<this.dimensions.rows;e+=1)this.cells[e]=[]}},{key:"initCols",value:function(){for(var e=0;e<this.dimensions.rows;e+=1)for(var t=0;t<this.dimensions.cols;t+=1)this.cells[e][t]=0}},{key:"calculateEmptyCells",value:function(){for(var e=[],t=0;t<this.dimensions.rows;t+=1)for(var n=0;n<this.dimensions.cols;n+=1)this.cells[t][n]===Cell.EMPTY&&e.push({row:t,col:n});return e}},{key:"spawnFruit",value:function(){var e=this.calculateEmptyCells(),t=Math.floor(Math.random()*(e.length-1));this.markFruitAt(e[t])}},{key:"markFruitAt",value:function(e){this.cells[e.row][e.col]=Cell.FRUIT}},{key:"hasFruitAt",value:function(e){return this.cells[e.row][e.col]===Cell.FRUIT}},{key:"markSnakeAt",value:function(e){this.cells[e.row][e.col]=Cell.SNAKE}},{key:"hasSnakeAt",value:function(e){return this.cells[e.row][e.col]===Cell.SNAKE}},{key:"hasWallAt",value:function(e){return e.row<0||e.row>this.dimensions.rows-1||e.col<0||e.col>this.dimensions.cols-1}},{key:"detectCollision",value:function(e){return this.hasWallAt(e)||this.hasSnakeAt(e)}},{key:"clearCell",value:function(e){this.cells[e.row][e.col]=Cell.EMPTY}}]),e}(),Direction=function t(){_classCallCheck(this,t)};Direction.LEFT=1,Direction.UP=2,Direction.RIGHT=3,Direction.DOWN=4;var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Snake=function(){function e(){_classCallCheck(this,e),this.init()}return _createClass(e,[{key:"init",value:function(e,t){this.parts=[this.head=e||{row:1,col:1}],this.direction=t||Direction.RIGHT}},{key:"calculateNextPosition",value:function(){var e=this.head,t=e.row,n=e.col;switch(this.direction){case Direction.LEFT:n-=1;break;case Direction.UP:t-=1;break;case Direction.RIGHT:n+=1;break;case Direction.DOWN:t+=1}return{row:t,col:n}}},{key:"advanceTo",value:function(e){this.parts.unshift(this.head=e)}},{key:"pullTail",value:function(){return this.parts.pop()}},{key:"turnLeft",value:function(){this.direction!==Direction.RIGHT&&(this.direction=Direction.LEFT)}},{key:"turnUp",value:function(){this.direction!==Direction.DOWN&&(this.direction=Direction.UP)}},{key:"turnRight",value:function(){this.direction!==Direction.LEFT&&(this.direction=Direction.RIGHT)}},{key:"turnDown",value:function(){this.direction!==Direction.UP&&(this.direction=Direction.DOWN)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Game=function(){function e(t,n){_classCallCheck(this,e),this.grid=t,this.snake=n,this.init()}return _createClass(e,[{key:"init",value:function(){this.initLevels(),this.score=0,this.level=this.levels.shift(),this.grid.init(),this.snake.init(),this.grid.spawnFruit(),this.grid.markSnakeAt(this.snake.head)}},{key:"update",value:function(){var e=this.snake.calculateNextPosition();return this.grid.detectCollision(e)?this.handleCollision():this.moveSnakeTo(e),this}},{key:"moveSnakeTo",value:function(e){this.grid.hasFruitAt(e)?this.handleScore():this.grid.clearCell(this.snake.pullTail()),this.snake.advanceTo(e),this.grid.markSnakeAt(this.snake.head)}},{key:"handleCollision",value:function(){this.init()}},{key:"handleScore",value:function(){this.grid.spawnFruit(),this.score+=this.level.score,this.score>=this.level.up&&(this.level=this.levels.shift())}},{key:"initLevels",value:function(){this.levels=[{ID:1,speed:10,score:50,up:200},{ID:2,speed:9,score:75,up:500},{ID:3,speed:8,score:100,up:1500},{ID:4,speed:7,score:125,up:3e3},{ID:5,speed:6,score:150,up:5e3},{ID:6,speed:5,score:175,up:7e3},{ID:7,speed:4,score:200,up:9e3},{ID:8,speed:3,score:250,up:1e4},{ID:9,speed:2,score:300,up:11e3},{ID:10,speed:1,score:500,up:12e3}]}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Input=function(){function e(t){_classCallCheck(this,e),this.snake=t}return _createClass(e,[{key:"createKeyDownListener",value:function(){var e=37,t=38,n=39,i=40,s=function(s){switch(s.keyCode){case e:this.snake.turnLeft();break;case t:this.snake.turnUp();break;case n:this.snake.turnRight();break;case i:this.snake.turnDown()}};return s.bind(this)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Renderer=function(){function e(t,n){_classCallCheck(this,e),this.canvas=t,this.dimensions=n,this.context=t.getContext("2d"),t.width=n.grid.cols*n.cell.width,t.height=n.grid.rows*n.cell.height}return _createClass(e,[{key:"render",value:function(e){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font="15px Monospace",this.context.fillText("SCORE:"+e.score,50,50),this.context.fillText("LEVEL:"+e.level.ID,50,100);for(var t=this.dimensions.cell.width,n=this.dimensions.cell.height,i=0;i<this.dimensions.grid.rows;i+=1)for(var s=0;s<this.dimensions.grid.cols;s+=1)if(e.grid.cells[i][s]!==Cell.EMPTY){var r=s*t,a=i*n;this.context.beginPath(),this.context.rect(r,a,t,n),this.context.stroke()}}}]),e}();!function(){var e={grid:{rows:20,cols:25},cell:{width:25,height:25}},t=new Renderer(document.createElement("canvas"),e),n=new Grid(e.grid),i=new Snake,s=new Game(n,i),r=new Input(i);document.addEventListener("keydown",r.createKeyDownListener()),document.body.appendChild(t.canvas);var a=0;!function o(){a++,a%s.level.speed===0&&t.render(s.update()),window.requestAnimationFrame(o)}()}();